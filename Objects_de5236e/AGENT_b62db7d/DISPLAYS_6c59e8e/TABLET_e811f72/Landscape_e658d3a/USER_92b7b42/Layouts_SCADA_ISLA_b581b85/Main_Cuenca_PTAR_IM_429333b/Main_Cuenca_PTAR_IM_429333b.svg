<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg height="590" version="1.2" width="1024" xmlns="http://www.w3.org/2000/svg" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs/>
 <metadata>
  <atv:gridconfig enabled="false" gridstyle="lines" height="20" width="20"/>
  <atv:snapconfig enabled="true" height="5" width="5"/>
 </metadata>
 <svg atv:refpx="1563.83" atv:refpy="624.439" height="600" id="topologia" transform="matrix(0.9009,0,0,0.6796,0,0)" width="800" x="1332.075" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.hmi.iframe" y="706.263">
  <atv:argument name="display" value="SYSTEM.LIBRARY.PROJECT.OBJECTDISPLAYS.Layouts_SCADA_ISLA.Cuencas.Cuenca_PTAR_IM"/>
  <atv:argument name="isNavigationFrame" value="true"/>
  <atv:argument name="frameName" value="topologia"/>
 </svg>
 <foreignObject height="480" id="mapa" width="720" x="1200" y="0">
  <div style="width:100%;height:100%" xmlns="http://www.w3.org/1999/xhtml"/>
 </foreignObject>
 <text atv:refpx="203.5" atv:refpy="854" fill="#000039" font-family="Arial" font-size="28" font-weight="bold" id="id_0" text-anchor="middle" x="203.5" y="858.5">Niveles aguas abajo</text>
 <text atv:refpx="849" atv:refpy="849" fill="#000039" font-family="Arial" font-size="28" font-weight="bold" id="id_2" x="741.5" y="858.5">Flujos entrantes</text>
 <svg atv:refpx="274.997" atv:refpy="240.996" height="130" id="id_5" transform="matrix(3.6667,0,0,2.5,0,0)" width="150" x="0" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dashboard.charts.bar" y="64">
  <atv:argument name="seriesOrientation" value="Vertical"/>
  <atv:argument name="series1Name" value="T{FINAL}"/>
  <atv:argument name="series2Name" value="T{ORIENTE}"/>
  <atv:argument name="series3Name" value="T{FOVISSSTE}"/>
  <atv:argument name="min" value="0"/>
  <atv:argument name="max" value="100"/>
  <atv:argument name="unit" value="T{%}"/>
  <atv:argument name="seriesCount" value="0"/>
  <atv:argument name="series4Name" value="T{AMPLIACIÓN}"/>
  <atv:argument name="series5Name" value="T{CAR 2}"/>
  <atv:argument name="series6Name" value="T{CAR 1}"/>
  <atv:argument name="series7Name" value="T{SALINAS}"/>
  <atv:argument name="series1Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Final_PTAR_IM.level_percent"/>
  <atv:argument name="series2Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Oriente.level_percent"/>
  <atv:argument name="series3Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Fovissste_IM.level_percent"/>
  <atv:argument name="series4Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Ampliacion.level_percent"/>
  <atv:argument name="series5Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_002_IM.level_percent"/>
  <atv:argument name="series8Name" value="T{ELECTRICISTAS}"/>
  <atv:argument name="series6Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_001_IM.level_percent"/>
  <atv:argument name="series9Name" value=""/>
  <atv:argument name="series7Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Salinas.level_percent"/>
  <atv:argument name="series8Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Electricistas.level_percent"/>
  <atv:overwrite id="sub_label" transform="matrix(0.2727,0,0,0.4,0,0)" x="275.002" y="179.873"/>
  <atv:overwrite id="main_label" transform="matrix(0.2727,0,0,0.4,0,0)" x="275.002" y="161.127"/>
  <atv:overwrite height="323" id="fo_container" transform="matrix(0.2727,0,0,0.4,0,0)" width="548.005"/>
  <atv:overwrite height="324" id="border" transform="matrix(0.2727,0,0,0.4,0,0)" width="549.005"/>
 </svg>
 <svg atv:refpx="848.995" atv:refpy="240.996" height="130" id="id_7" transform="matrix(4,0,0,2.5,0,0)" width="150" x="137.25" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dashboard.charts.bar" y="64">
  <atv:argument name="series1Name" value="T{FINAL}"/>
  <atv:argument name="series2Name" value="T{ORIENTE}"/>
  <atv:argument name="series3Name" value="T{FOVISSSTE}"/>
  <atv:argument name="min" value="0"/>
  <atv:argument name="unit" value="T{l/s}"/>
  <atv:argument name="seriesCount" value="0"/>
  <atv:argument name="series4Name" value="T{AMPLIACIÓN}"/>
  <atv:argument name="series5Name" value="T{CAR 2}"/>
  <atv:argument name="series6Name" value="T{CAR 1}"/>
  <atv:argument name="series7Name" value="T{SALINAS}"/>
  <atv:argument name="series1Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Final_PTAR_IM.flow"/>
  <atv:argument name="series2Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Oriente.flow"/>
  <atv:argument name="series3Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Fovissste_IM.flow"/>
  <atv:argument name="series4Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Ampliacion.flow"/>
  <atv:argument name="series5Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_002_IM.flow"/>
  <atv:argument name="series8Name" value="T{ELECTRICISTAS}"/>
  <atv:argument name="series6Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_001_IM.flow"/>
  <atv:argument name="series9Name" value=""/>
  <atv:argument name="series7Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Salinas.flow"/>
  <atv:argument name="series8Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Electricistas.flow"/>
  <atv:overwrite id="sub_label" transform="matrix(0.25,0,0,0.4,0,0)" x="300" y="179.873"/>
  <atv:overwrite id="main_label" transform="matrix(0.25,0,0,0.4,0,0)" x="300" y="161.127"/>
  <atv:overwrite height="323" id="fo_container" transform="matrix(0.25,0,0,0.4,0,0)" width="598"/>
  <atv:overwrite height="324" id="border" transform="matrix(0.25,0,0,0.4,0,0)" width="599"/>
 </svg>
 <text atv:refpx="181.43" atv:refpy="71" fill="#000039" font-family="Arial" font-size="28" font-weight="bold" id="id_6" x="60" y="80.5">PTAR Isla Mujeres</text>
 <script atv:desc="" atv:name="" type="text/ecmascript"><![CDATA[//----------------Inicializo variables -------------------//


//Variable interna
var Info_Windowact=false;
var Markeract=false;
var Markeractdc;
var Markers= new Array();
var Rutas= new Array();
var Pos_origen;
var Pos_destination;
var WayPoints = new Array();

var google = webMI.rootWindow.google; //Clase Principal
var map; //Variable donde va a vivir el mapa
var m,n;
var circuito =
	[[21.256399347040773, -86.74833407863943],				
	 [21.23733132548439, -86.73423935451817],
	 [21.230061804420455, -86.72912305806504],	
	 [21.228821796795305, -86.7309422185574],	 
	 [21.22474579879822, -86.72865428295026],	 	 
	 [21.23739336154124, -86.73793464795995],
	 [21.216666288431952, -86.72058750077977],				
	 [21.226261283498463, -86.72535608973155],
	 [21.224254282385132, -86.73038563512674],	
	 [21.222750512227783, -86.72398068882747],	 
	 [21.219149141158397, -86.72270566402689],
	 [21.235188900537057, -86.74114125698128],		 	 
	 [21.23420376849967, -86.73318474136586],	 	 
	 [21.21671110356268, -86.72089443675505]]

					
var circuito_s =
	[[{lat:21.256399347040773, lng:-86.74833407863943},
	"Cárcamo  1, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_001_IM",
	1, "carcamoAR"],
	[{lat:21.23733132548439, lng:-86.73423935451817},
	"Cárcamo 2, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_002_IM",
	2, "carcamoAR"],
	[{lat:21.230061804420455, lng:-86.72912305806504},
	"Cárcamo Ampliación La Gloria, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Ampliacion",
	3, "carcamoAR"],
	[{lat:21.228821796795305, lng:-86.7309422185574},
	"Cárcamo Caridad del Cobre, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Caridad_Cobre",
	4, "carcamoAR"],
	[{lat:21.22474579879822, lng:-86.72865428295026},
	"Cárcamo Cañotal, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Cañotal",
	5, "carcamoAR"],
	[{lat:21.23739336154124, lng:-86.73793464795995},
	"Cárcamo Electricistas, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Electricistas",
	6, "carcamoAR"],
	[{lat:21.216666288431952, lng:-86.72058750077977},
	"Cárcamo Final, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Final_PTAR_IM",
	7, "carcamoAR"],
	[{lat:21.226261283498463, lng:-86.72535608973155},
	"Cárcamo Fovissste, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Fovissste_IM",
	8, "carcamoAR"],
	[{lat:21.224254282385132, lng:-86.73038563512674},
	"Cárcamo Miraflores, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Miraflores",
	9, "carcamoAR"],
	[{lat:21.222750512227783, lng:-86.72398068882747},
	"Cárcamo Oriente, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Oriente",
	10, "carcamoAR"],
	[{lat:21.219149141158397, lng:-86.72270566402689},
	"Cárcamo Poniente, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Poniente",
	11, "carcamoAR"],
	[{lat:21.235188900537057, lng:-86.74114125698128},
	"Cárcamo Sacbajo, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Sacbajo",
	12, "carcamoAR"],
	[{lat:21.23420376849967, lng:-86.73318474136586},
	"Cárcamo Salinas, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Salinas",
	13, "carcamoAR"],
	[{lat:21.21671110356268, lng:-86.72089443675505},
	"PTAR Isla Mujeres, Agua Residual",
	"AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Final_PTAR_IM",
	14, "ptar"]];
					
var infowindow;					
var circuito_centro;
var carcamoAR = "/icons/carcamo_ar_30_18px.png";



//----------------Ejecución -------------------//



//Determinación del dispositivo
var infoCliente;
infoCliente = new webMI.getClientInfo();

//Preprocesamiento de variables

//Calculo del Centro
var suma=[0,0];
for (var i=0; i<circuito.length; i++){
	suma[0]=suma[0]+circuito[i][0]; //Latitud 
	suma[1]=suma[1]+circuito[i][1]; //Longitud
}

circuito_centro=[suma[0]/circuito.length,suma[1]/circuito.length];


webMI.addOnload(function() {
	
	//Posiciones en el mapa
	var position1 = new google.maps.LatLng(circuito_centro[0], circuito_centro[1]);
	
	//Opciones del mapa
	var myOptions = {
		zoom: 13,
		center: position1,
		mapTypeId: google.maps.MapTypeId.roadmap
	};
	

	//Inicializo el mapa
	map = new google.maps.Map(document.getElementById("mapa"), myOptions);
	
	
		
	
		
	// Instantiate an info window to hold step text.
	const stepDisplay = new google.maps.InfoWindow();
	
	
	//-------Inicializo Marcadores
	
	circuito_s.forEach(([position,title,object,order,type],i) =>{
	if (type == 'ptar') {
	carcamoAR = "/icons/planta.png"
	}
	
	
		const marker = new google.maps.Marker({
			position, 
			map,
			icon: carcamoAR,
			title: ` ${order}`,
			optimized: false,
		});
		
		marker.setMap(map);
		
		//Agrego marcador a lista de marcadores
		Markers.push(marker);
	
		//-------Listener de Marcadores
		
		//DOBLECLICK (Fija Carcamo)
		google.maps.event.addListener(marker,'dblclick',function(event) {
							
			//Abrir display en frame de la izquierda, en la primera posición, relativo a la base		
			webMI.display.openDisplay("ObjectTypes.PROJECT.ElementoLineaAR.Tanque",
			{base:   object}, "topologia");			
			map.panTo(this.getPosition());
			map.setZoom(16.5);

			Markeract=true;
			Markeractdc=marker;
			Pos_origen=position;
		
			
			//Limpio
			Elimina_Ruta(Rutas);
				
		});
	/*	map.addListener("zoom_changed", () => {
    infowindow.setContent("Zoom: " + map.getZoom());
  });*/
		
		
		//CLICK (Abre Infowindow)
		google.maps.event.addListener(marker,'click',function(event) {	
			
			//Abro en temporal
			if (marker!=Markeractdc && Markeract==true ){		
				Pos_destination=position;	
				
				//Limpio
				Elimina_Ruta(Rutas);
				
				//Dibujo
				Dibuja_Ruta(Pos_origen,Pos_destination);
			}
			
			
		});	
			
		
		//MOUSEOVER
		google.maps.event.addListener(marker, "mouseover", function(event){
			infowindow = new google.maps.InfoWindow();
			//Abro marcador
			infowindow.open(marker.getMap,marker);
			Info_Windowact=true;
			//Defino que objeto va a ser el seleccionado para mostrar su información
			webMI.data.subscribe( object +".level_percent",
			function(e){
				infowindow.setContent(title+" - Nivel: " +
				e.value.toFixed(2) + "%");
				}
			);
			
				//infowindow.setContent(title);
		
		});	
		
		//MOUSEOUT
		google.maps.event.addListener(marker, "mouseout", function(event){
			
			
			if (Info_Windowact){
				infowindow.close();
				Info_Windowact=false;
			}			
		});
		
		
		
	});	
			
});



function Dibuja_Ruta(Origen,Destination){
	
	if(Markeract && (Origen!=Destination)){
			
		//////////// Servicios Rutas en el mapa
		var directionsService = new google.maps.DirectionsService();
		var directionsRenderer = new google.maps.DirectionsRenderer({ map: map });		
		
		//Crea el request
		var request = {
			origin: Origen,
			destination:Destination,
			travelMode: google.maps.TravelMode.DRIVING // Puedes ajustar el modo de transporte según tus necesidades
		  };    
		
		
		directionsService.route(request, function(response, status) {
			if (status == google.maps.DirectionsStatus.OK) {
			  directionsRenderer.setDirections(response);
			  Rutas.push(directionsRenderer);
			}
		  });
	 }
    
 }


function Elimina_Ruta(Rutas){
	
	Rutas.forEach(function(ruta) {
		ruta.setMap(null);
	});
	
	Rutas=new Array();
    
 }
]]></script>
 <svg atv:refpx="274.996" atv:refpy="565.996" height="130" id="id_1" transform="matrix(3.6667,0,0,2.5,0,0)" width="150" x="0" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dashboard.charts.bar" y="194">
  <atv:argument name="seriesOrientation" value="Vertical"/>
  <atv:argument name="series1Name" value="T{PONIENTE}"/>
  <atv:argument name="series2Name" value="T{SACBAJO}"/>
  <atv:argument name="series3Name" value="T{MIRAFLORES}"/>
  <atv:argument name="min" value="0"/>
  <atv:argument name="max" value="100"/>
  <atv:argument name="unit" value="T{%}"/>
  <atv:argument name="seriesCount" value="0"/>
  <atv:argument name="series4Name" value="T{CAÑOTAL}"/>
  <atv:argument name="series5Name" value="T{CARIDAD}"/>
  <atv:argument name="series6Name" value=""/>
  <atv:argument name="series7Name" value=""/>
  <atv:argument name="series1Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Poniente.level_percent"/>
  <atv:argument name="series2Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Sacbajo.level_percent"/>
  <atv:argument name="series3Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Miraflores.level_percent"/>
  <atv:argument name="series4Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Cañotal.level_percent"/>
  <atv:argument name="series5Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Caridad_Cobre.level_percent"/>
  <atv:argument name="series8Name" value=""/>
  <atv:argument name="series9Name" value=""/>
  <atv:overwrite id="sub_label" transform="matrix(0.2727,0,0,0.4,0,0)" x="275.002" y="179.873"/>
  <atv:overwrite id="main_label" transform="matrix(0.2727,0,0,0.4,0,0)" x="275.002" y="161.127"/>
  <atv:overwrite height="323" id="fo_container" transform="matrix(0.2727,0,0,0.4,0,0)" width="548.005"/>
  <atv:overwrite height="324" id="border" transform="matrix(0.2727,0,0,0.4,0,0)" width="549.005"/>
 </svg>
 <svg atv:refpx="848.994" atv:refpy="565.996" height="130" id="id_3" transform="matrix(4,0,0,2.5,0,0)" width="150" x="137.25" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.dashboard.charts.bar" y="194">
  <atv:argument name="series1Name" value="T{PONIENTE}"/>
  <atv:argument name="series2Name" value="T{SACBAJO}"/>
  <atv:argument name="series3Name" value="T{MIRAFLORES}"/>
  <atv:argument name="min" value="0"/>
  <atv:argument name="unit" value="T{l/s}"/>
  <atv:argument name="seriesCount" value="0"/>
  <atv:argument name="series4Name" value="T{CAÑOTAL}"/>
  <atv:argument name="series5Name" value="T{CARIDAD}"/>
  <atv:argument name="series6Name" value=""/>
  <atv:argument name="series7Name" value=""/>
  <atv:argument name="series1Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Poniente.flow"/>
  <atv:argument name="series2Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Sacbajo.flow"/>
  <atv:argument name="series3Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Miraflores.flow"/>
  <atv:argument name="series4Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Cañotal.flow"/>
  <atv:argument name="series5Address" value="AGENT.OBJECTS.SCADA.Isla_Mujeres.Cuencas.Cuenca_PTAR_IM.Carcamo_Caridad_Cobre.flow"/>
  <atv:argument name="series8Name" value=""/>
  <atv:argument name="series9Name" value=""/>
  <atv:overwrite id="sub_label" transform="matrix(0.25,0,0,0.4,0,0)" x="300" y="179.873"/>
  <atv:overwrite id="main_label" transform="matrix(0.25,0,0,0.4,0,0)" x="300" y="161.127"/>
  <atv:overwrite height="323" id="fo_container" transform="matrix(0.25,0,0,0.4,0,0)" width="598"/>
  <atv:overwrite height="324" id="border" transform="matrix(0.25,0,0,0.4,0,0)" width="599"/>
 </svg>
</svg>
