<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg height="554" version="1.2" width="1912" xmlns="http://www.w3.org/2000/svg" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs/>
 <metadata>
  <!-- parámetro base del equipo -->
  <atv:parameter behavior="mandatory" desc="Nodo base" name="base" valuetype="address"/>
  <atv:gridconfig enabled="false" gridstyle="lines" height="20" width="20"/>
  <atv:snapconfig enabled="false" height="10" width="10"/>
 </metadata>
 <!-- Título: toma base.name -->
 <text atv:refpx="44.5" atv:refpy="21" font-family="Arial" font-size="20" font-weight="bold" id="title" x="12" y="28">Equipo</text>
 <!-- CHART EQUIPO (auto-oculta series no existentes) -->
 <!-- Script: oculta series que no tengan nodo -->
 <script atv:desc="" atv:name="" type="text/ecmascript"><![CDATA[
webMI.addOnload(function () {
  // serie -> sufijo de nodo relativo a base
  var seriesMap = {
    1: ".status",
    2: ".FP",
    3: ".freq",
    4: ".current",
    5: ".current2",
    6: ".current3",
    7: ".voltage"
  };

  var base = webMI.query["base"] || "";
  var trend = webMI.trendFactory.getTrendByName("equipo");
  if (!trend) return;

  Object.keys(seriesMap).forEach(function (s) {
    var addr = base + seriesMap[s];
    webMI.data.read(addr, function (r) {
      var exists = r && (typeof r.value !== "undefined" || typeof r.status !== "undefined");
      if (!exists) {
        // esconder serie s (índice base 1 en parámetros; Highcharts usa 0)
        try {
          var idx = parseInt(s,10)-1;
          var hcSeries = trend.chart.series[idx];
          if (hcSeries) hcSeries.setVisible(false, false);
          // también quita de la leyenda si aplica
          trend.chart.update({ series: [{},{},{},{},{},{},{}] }, false);
          trend.chart.redraw();
        } catch(e){}
      }
    });
  });
});
]]></script>
 <!-- Contenedor de Highcharts (usa el objeto estándar de atvise) -->
 <!-- Highcharts -->
 <svg atv:refpx="956" atv:refpy="297.6" height="400" id="chart" transform="matrix(4.78,0,0,1.2,0,0)" width="400" x="0" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.highcharts.highcharts" y="48">
  <atv:argument name="trendName" value="equipo"/>
  <atv:argument name="trendGroup" value="grupo_equipo"/>
  <atv:argument name="gatviseOptions_mode" value="mixed"/>
  <!-- rango y etiquetas del eje X -->
  <atv:argument name="xAxisxAxis_timeSpanUnit" value="hour(s)"/>
  <atv:argument name="xAxisxAxis_timeSpan" value="12"/>
  <atv:argument name="xAxisxAxis_tickInterval" value="8600000"/>
  <atv:argument name="xAxisxAxis_title_text" value="Tiempo"/>
  <!-- y-axes (ids cortos para mapear series) -->
  <atv:argument name="yAxis1yAxis_id" value="bin"/>
  <atv:argument name="yAxis1yAxis_title_text" value="Estados"/>
  <atv:argument name="yAxis1yAxis_min" value="-1"/>
  <atv:argument name="yAxis1yAxis_max" value="2"/>
  <atv:argument name="yAxis2yAxis_id" value="fp"/>
  <atv:argument name="yAxis2yAxis_title_text" value="Factor de potencia"/>
  <atv:argument name="yAxis2yAxis_min" value="0"/>
  <atv:argument name="yAxis2yAxis_max" value="1"/>
  <atv:argument name="yAxis3yAxis_id" value="f"/>
  <atv:argument name="yAxis3yAxis_title_text" value="Frecuencia"/>
  <atv:argument name="yAxis3yAxis_min" value="0"/>
  <atv:argument name="yAxis3yAxis_max" value="60"/>
  <atv:argument name="yAxis4yAxis_id" value="i"/>
  <atv:argument name="yAxis4yAxis_title_text" value="Corriente"/>
  <atv:argument name="yAxis4yAxis_min" value="0"/>
  <!-- SERIES PRINCIPALES -->
  <!-- On/Off (step, binario) -->
  <atv:argument name="series1series_address" prefix="base" value=".status"/>
  <atv:argument name="series1series_interpolation" value="step"/>
  <atv:argument name="series1series_yAxis" value="bin"/>
  <atv:argument name="series1series_name" value="T{On/Off}"/>
  <atv:argument name="series1series_color" value="#000000"/>
  <atv:argument name="series1series_lineWidth" value="3"/>
  <atv:argument name="series1series_marker_enabled" value="false"/>
  <!-- FP -->
  <atv:argument name="series2series_address" prefix="base" value=".FP"/>
  <atv:argument name="series2series_yAxis" value="fp"/>
  <atv:argument name="series2series_name" value="T{Factor de potencia}"/>
  <atv:argument name="series2series_color" value="#28832e"/>
  <atv:argument name="series2series_lineWidth" value="3"/>
  <atv:argument name="series2series_marker_enabled" value="false"/>
  <atv:argument name="series2series_tooltip_valueDecimals" value="2"/>
  <!-- Frecuencia -->
  <atv:argument name="series3series_address" prefix="base" value=".freq"/>
  <atv:argument name="series3series_yAxis" value="f"/>
  <atv:argument name="series3series_name" value="T{Frecuencia}"/>
  <atv:argument name="series3series_color" value="#24359f"/>
  <atv:argument name="series3series_lineWidth" value="3"/>
  <atv:argument name="series3series_marker_enabled" value="false"/>
  <atv:argument name="series3series_tooltip_valueDecimals" value="1"/>
  <atv:argument name="series3series_tooltip_valueSuffix" value=" Hz"/>
  <!-- Corriente L1 -->
  <atv:argument name="series4series_address" prefix="base" value=".current"/>
  <atv:argument name="series4series_yAxis" value="i"/>
  <atv:argument name="series4series_name" value="T{Corriente L1}"/>
  <atv:argument name="series4series_color" value="#a67616"/>
  <atv:argument name="series4series_lineWidth" value="3"/>
  <atv:argument name="series4series_marker_enabled" value="false"/>
  <atv:argument name="series4series_tooltip_valueDecimals" value="1"/>
  <atv:argument name="series4series_tooltip_valueSuffix" value=" A"/>
  <!-- OPCIONALES: Corriente L2 / L3 / Voltaje (si no existen se ocultan por script) -->
  <atv:argument name="series5series_address" prefix="base" value=".current2"/>
  <atv:argument name="series5series_yAxis" value="i"/>
  <atv:argument name="series5series_name" value="T{Corriente L2}"/>
  <atv:argument name="series5series_lineWidth" value="3"/>
  <atv:argument name="series5series_marker_enabled" value="false"/>
  <atv:argument name="series6series_address" prefix="base" value=".current3"/>
  <atv:argument name="series6series_yAxis" value="i"/>
  <atv:argument name="series6series_name" value="T{Corriente L3}"/>
  <atv:argument name="series6series_lineWidth" value="3"/>
  <atv:argument name="series6series_marker_enabled" value="false"/>
  <atv:argument name="series7series_address" prefix="base" value=".voltage"/>
  <atv:argument name="series7series_name" value="T{Voltaje}"/>
  <atv:argument name="series7series_lineWidth" value="3"/>
  <atv:argument name="series7series_marker_enabled" value="false"/>
  <atv:argument name="series7series_tooltip_valueDecimals" value="0"/>
  <atv:argument name="series7series_tooltip_valueSuffix" value=" V"/>
  <!-- Config persistente por equipo -->
  <atv:argument name="gatviseOptions_configNode" prefix="base" value=".conf"/>
  <atv:argument name="gatviseOptions_configName" value="Equipo"/>
  <!-- Ajuste de tamaño interno del template (quita la etiqueta “Highcharts”) -->
  <atv:overwrite id="highchart_label" transform="matrix(0.209,0,0,0.83,0,0)" x="785.5" y="251.5"/>
  <atv:overwrite height="478" id="border" transform="matrix(0.209,0,0,0.83,0,0)" width="1910"/>
  <atv:overwrite height="480" id="id_3" transform="matrix(0.209,0,0,0.83,0,0)" width="1912"/>
 </svg>
 <!-- Botonera de navegación Highcharts -->
 <svg atv:refpx="1140" atv:refpy="21" height="30" id="id_0" width="80" x="1100" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.highcharts.button_back" y="6">
  <atv:argument name="chartname" value="equipo"/>
 </svg>
 <svg atv:refpx="1230" atv:refpy="21" height="30" id="id_1" width="80" x="1190" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.highcharts.button_forward" y="6">
  <atv:argument name="chartname" value="equipo"/>
 </svg>
 <svg atv:refpx="1510" atv:refpy="21" height="30" id="id_2" width="460" x="1270" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.highcharts.buttons_start_end_time" y="6">
  <atv:argument name="chartname" value="equipo"/>
 </svg>
 <svg atv:refpx="1730" atv:refpy="21" height="30" id="id_3" width="141" x="1740" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.highcharts.toolbar" y="6">
  <atv:argument name="chartname" value="equipo"/>
 </svg>
</svg>
