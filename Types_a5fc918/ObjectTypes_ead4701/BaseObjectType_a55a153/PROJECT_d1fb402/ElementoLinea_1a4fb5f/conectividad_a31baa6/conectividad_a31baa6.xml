<?xml version="1.0" encoding="UTF-8"?>
<script>
  <metadata>
    <priority>0</priority>
    <owner>root</owner>
    <runcontext>caller</runcontext>
  </metadata>
  <parameter name="connectivity" type="interval" trigger="true" relative="false" value=".connectivity" offset="00:00:00" interval="00:01:00"/>
  <code><![CDATA[// Obtenemos los nodos base
var connectivity = Ua.findNode(base + ".connectivity");
var connect = Ua.findNode(base + ".connect");
var ip = Ua.findNode(base + ".ip");
var com = Ua.findNode(base + ".com");

// Si el método de conexión es GPRS, usamos el valor del nodo gprsConnect
if (ip.result.value == "GPRS") {
    var gprs = Ua.findNode(base + ".gprsConnect");
    // Si gprs.result.value es 1, consideramos que hay conectividad; en caso contrario, no.
    if (gprs.result.value == 1) {
        connect.result.value = true;
    } else {
        connect.result.value = false;
    }
    // Actualizamos la marca de conectividad en el nodo connectivity
    connectivity.result.value = connect.result.value;
} else {
    // Para otros métodos de conexión:
    // Primero validamos la calidad (status). Si status NO es 0, hay problemas.
    if (connectivity.result != undefined) {
        if (connectivity.result.status != 0) {
            connect.result.value = false;
        } else {
            // Si status es 0, validamos connectivity.result.value.
            // Si value es 0 o false, la conectividad se considera ausente,
            // aunque status sea 0.
            if (connectivity.result.value == 0) {
                connect.result.value = false;
            } else {
                connect.result.value = true;
            }
        }
    }
}

// Finalmente, se iguala el resultado en com al de connect.
com.result.value = connect.result.value;]]></code>
</script>
